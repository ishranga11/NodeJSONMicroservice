var cov_1xz8mgk8hs=function(){var path="F:\\NodeJSONAssign\\middleware\\imageDownload.js";var hash="e3d6f9d73b286d5af7ba110c1f62d97b889b3723";var Function=function(){}.constructor;var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"F:\\NodeJSONAssign\\middleware\\imageDownload.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:44}},"1":{start:{line:2,column:13},end:{line:2,column:28}},"2":{start:{line:3,column:11},end:{line:3,column:24}},"3":{start:{line:4,column:18},end:{line:4,column:39}},"4":{start:{line:6,column:0},end:{line:40,column:2}},"5":{start:{line:7,column:14},end:{line:7,column:40}},"6":{start:{line:8,column:20},end:{line:11,column:5}},"7":{start:{line:12,column:4},end:{line:39,column:5}},"8":{start:{line:13,column:8},end:{line:33,column:14}},"9":{start:{line:15,column:16},end:{line:32,column:18}},"10":{start:{line:19,column:32},end:{line:19,column:52}},"11":{start:{line:20,column:36},end:{line:20,column:47}},"12":{start:{line:21,column:20},end:{line:21,column:43}},"13":{start:{line:22,column:20},end:{line:22,column:85}},"14":{start:{line:23,column:20},end:{line:25,column:23}},"15":{start:{line:26,column:20},end:{line:26,column:27}},"16":{start:{line:28,column:20},end:{line:28,column:36}},"17":{start:{line:29,column:20},end:{line:31,column:8}},"18":{start:{line:35,column:8},end:{line:35,column:24}},"19":{start:{line:36,column:8},end:{line:38,column:10}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:6,column:17},end:{line:6,column:18}},loc:{start:{line:6,column:35},end:{line:40,column:1}},line:6},"1":{name:"(anonymous_1)",decl:{start:{line:14,column:18},end:{line:14,column:19}},loc:{start:{line:14,column:36},end:{line:33,column:13}},line:14},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:23},end:{line:18,column:24}},loc:{start:{line:18,column:30},end:{line:27,column:17}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:27,column:25},end:{line:27,column:26}},loc:{start:{line:27,column:34},end:{line:32,column:17}},line:27}},branchMap:{"0":{loc:{start:{line:12,column:4},end:{line:39,column:5}},type:"if",locations:[{start:{line:12,column:4},end:{line:39,column:5}},{start:{line:12,column:4},end:{line:39,column:5}}],line:12},"1":{loc:{start:{line:12,column:7},end:{line:12,column:75}},type:"binary-expr",locations:[{start:{line:12,column:7},end:{line:12,column:22}},{start:{line:12,column:26},end:{line:12,column:40}},{start:{line:12,column:44},end:{line:12,column:57}},{start:{line:12,column:61},end:{line:12,column:75}}],line:12}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0,0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const download=(cov_1xz8mgk8hs.s[0]++,require('image-downloader'));const path=(cov_1xz8mgk8hs.s[1]++,require('path'));const fs=(cov_1xz8mgk8hs.s[2]++,require('fs'));const resizeImg=(cov_1xz8mgk8hs.s[3]++,require('resize-img'));cov_1xz8mgk8hs.s[4]++;module.exports=(req,res,next)=>{cov_1xz8mgk8hs.f[0]++;let ext=(cov_1xz8mgk8hs.s[5]++,path.extname(req.body.url));const options=(cov_1xz8mgk8hs.s[6]++,{url:req.body.url,dest:'./public/images/'});cov_1xz8mgk8hs.s[7]++;if((cov_1xz8mgk8hs.b[1][0]++,ext==='.jpeg')||(cov_1xz8mgk8hs.b[1][1]++,ext==='.jpg')||(cov_1xz8mgk8hs.b[1][2]++,ext==='.png')||(cov_1xz8mgk8hs.b[1][3]++,ext==='.bmp')){cov_1xz8mgk8hs.b[0][0]++;cov_1xz8mgk8hs.s[8]++;download.image(options).then(({filename})=>{cov_1xz8mgk8hs.f[1]++;cov_1xz8mgk8hs.s[9]++;resizeImg(fs.readFileSync(filename),{width:50,height:50}).then(buf=>{cov_1xz8mgk8hs.f[2]++;let fName=(cov_1xz8mgk8hs.s[10]++,filename.split("\\"));let finalName=(cov_1xz8mgk8hs.s[11]++,fName.pop());cov_1xz8mgk8hs.s[12]++;console.log(finalName);cov_1xz8mgk8hs.s[13]++;fs.writeFileSync("./public/images/thumbnails/"+finalName,buf);cov_1xz8mgk8hs.s[14]++;res.json({message:"Successfully saved"});cov_1xz8mgk8hs.s[15]++;next();}).catch(err=>{cov_1xz8mgk8hs.f[3]++;cov_1xz8mgk8hs.s[16]++;res.status(403);cov_1xz8mgk8hs.s[17]++;res.json({messsage:err});});});}else{cov_1xz8mgk8hs.b[0][1]++;cov_1xz8mgk8hs.s[18]++;res.status(403);cov_1xz8mgk8hs.s[19]++;res.json({Message:"Image extensions allowed -> jpg,jpeg,bmp,png"});}};